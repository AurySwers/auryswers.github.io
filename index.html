<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SwersGPT Web</title>
  <style>
    body { margin:0; font-family: 'Segoe UI', sans-serif; background:#121212; color:white; height:100vh; display:flex; flex-direction:column; }
    .top { padding:15px 20px; background:#1e1e1e; border-bottom:1px solid #333; display:flex; align-items:center; gap:15px; }
    .title { font-size:26px; font-weight:bold; }
    .voice-btn, .reset-btn { padding:10px 18px; background:#6e56cf; border:none; border-radius:25px; cursor:pointer; font-size:15px; }
    .reset-btn { background:#ff6b6b; margin-left:10px; }
    .chat-container { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px; }
    .message { max-width:70%; padding:12px 18px; border-radius:18px; line-height:1.5; word-wrap:break-word; }
    .user { align-self:flex-end; background:#0f3d0f; border-bottom-right-radius:4px; }
    .ai   { align-self:flex-start; background:#1a1a1a; border-bottom-left-radius:4px; }
    .input-area { padding:15px; background:#1e1e1e; display:flex; gap:10px; border-top:1px solid #333; }
    #input { flex:1; padding:14px 20px; background:#2a2a2a; border:none; border-radius:25px; color:white; font-size:16px; outline:none; }
    #send { padding:0 28px; background:#6e56cf; border:none; border-radius:25px; color:white; font-weight:bold; cursor:pointer; }
    .loading { opacity:0.6; font-style:italic; }
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:999; }
    .modal-content { background:#1e1e1e; padding:35px; border-radius:15px; width:420px; text-align:center; }
    .modal input { width:100%; padding:14px; margin:15px 0; background:#333; border:none; border-radius:8px; color:white; font-size:16px; }
    .modal button { padding:12px 30px; background:#6e56cf; border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold; }
  </style>
</head>
<body>

  <!-- API Key Modal -->
  <div id="keyModal" class="modal">
    <div class="modal-content">
      <h2>SwersGPT</h2>
      <p>G√ºvenlik i√ßin Groq API anahtarƒ± gerekiyor</p>
      <p><a href="https://console.groq.com/keys" target="_blank" style="color:#6e56cf;">console.groq.com/keys</a></p>
      <input type="text" id="apiKeyInput" placeholder="gsk_XXXXXXXXXXXXXXXXXXXXXXXX" />
      <button id="saveKeyBtn">Kaydet ve Ba≈ülat</button>
      <p style="font-size:12px; margin-top:20px;">2025 AurySoftWare ¬©</p>
    </div>
  </div>

  <!-- Ana Aray√ºz -->
  <div class="top">
    <div class="title">SwersGPT</div>
    <button class="voice-btn" id="voiceBtn">Sesli Konu≈ü</button>
    <button class="reset-btn" id="resetKeyBtn" title="Anahtarƒ± sƒ±fƒ±rla">üîÑ</button>
  </div>

  <div id="messages" class="chat-container">
    <!-- ilk mesaj -->
  </div>

  <div class="input-area">
    <input type="text" id="input" placeholder="Mesaj yaz‚Ä¶" autocomplete="off" />
    <button id="send">G√∂nder</button>
  </div>

  <script>
    const messagesDiv = document.getElementById('messages');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const voiceBtn = document.getElementById('voiceBtn');
    const resetKeyBtn = document.getElementById('resetKeyBtn');
    const modal = document.getElementById('keyModal');
    const saveKeyBtn = document.getElementById('saveKeyBtn');

    let API_KEY = localStorage.getItem('groq_key');

    // API Key kontrol√º
    if (!API_KEY) {
      modal.style.display = 'flex';
    } else {
      addMessage("Ho≈ü geldin! Artƒ±k sohbet edebilirsin", 'ai');
    }

    saveKeyBtn.onclick = () => {
      const key = document.getElementById('apiKeyInput').value.trim();
      if (!key) return alert('API key bo≈ü olamaz!');
      localStorage.setItem('groq_key', key);
      API_KEY = key;
      modal.style.display = 'none';
      addMessage("Anahtar kaydedildi! ≈ûimdi konu≈üalƒ±m", 'ai');
    };

    // YENƒ∞: Anahtarƒ± sƒ±fƒ±rla butonu
    resetKeyBtn.onclick = () => {
      localStorage.removeItem('groq_key');
      API_KEY = null;
      messagesDiv.innerHTML = ''; // Sohbeti temizle
      modal.style.display = 'flex';
      alert('Anahtar sƒ±fƒ±rlandƒ±! Yeni anahtar girin.');
    };

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      div.innerHTML = text.replace(/\n/g, '<br>');
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      return div;
    }

    // G√úNCELLENDƒ∞: Model llama-3.3-70b-versatile olarak deƒüi≈ütirildi
    const sendMessage = async () => {
      const text = input.value.trim();
      if (!text || !API_KEY) return;

      addMessage(text, 'user');
      input.value = '';
      const loadingMsg = addMessage('Yazƒ±yor...', 'ai');
      loadingMsg.classList.add('loading');

      try {
        const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: "llama-3.3-70b-versatile",  // ‚Üê D√úZELTƒ∞LDƒ∞: Yeni model
            messages: [{ role: "user", content: text }],
            temperature: 0.7,
            max_tokens: 2048
          })
        });

        const data = await res.json();
        if (data.error) throw new Error(data.error.message);

        loadingMsg.innerHTML = data.choices[0].message.content.replace(/\n/g, '<br>');
        loadingMsg.classList.remove('loading');
      } catch (e) {
        loadingMsg.innerHTML = `Hata: ${e.message}`;
        loadingMsg.style.color = '#ff6b6b';
      }
    };

    // Enter ve G√∂nder butonu
    sendBtn.onclick = sendMessage;
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Sesli giri≈ü (Chrome/Edge)
    voiceBtn.onclick = () => {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Ses tanƒ±ma bu tarayƒ±cƒ±da desteklenmiyor (Chrome kullan)');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'tr-TR';
      recognition.interimResults = false;

      voiceBtn.textContent = 'Dinliyor...';
      recognition.start();

      recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        input.value = text;
        voiceBtn.textContent = 'Sesli Konu≈ü';
        sendMessage();
      };

      recognition.onerror = () => {
        voiceBtn.textContent = 'Sesli Konu≈ü';
      };

      recognition.onend = () => {
        voiceBtn.textContent = 'Sesli Konu≈ü';
      };
    };
  </script>
</body>
</html>